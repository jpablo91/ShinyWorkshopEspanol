<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Lab IIa</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">CADMS</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Pre Workshop
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="0a_Intro_req.html">Requisitos</a>
    </li>
    <li>
      <a href="0b_Intro_to_R.html">Intro to R</a>
    </li>
    <li>
      <a href="0c_Spatial_intro.html">Intro to Spatial data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Contact
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Instructores.html">
        <span class="fa fa-users"></span>
         
        Instructores
      </a>
    </li>
    <li>
      <a href="https://cadms.vetmed.ucdavis.edu">
        <span class="fa fa-server"></span>
         
        CADMS Website
      </a>
    </li>
    <li>
      <a href="mailto:jpgo@ucdavis.edu">
        <span class="fa fa-envelope"></span>
         
        Email
      </a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Lab IIa</h1>

</div>


<div id="introduccion" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Introduccion</h1>
<p>Objetivo:<br />
En este laboratorio vamos a introducir shinydashboard. Seguiremos construyendo en el archivo que creamos para una aplicacion basica en el <a href="Lab_Ib.html">laboratorio Ib</a>, si no terminaste el laboratorio, puedes descargar el checkpoint en <a href="https://ucdavis.box.com/s/gtr5c4qotr787htvessx4fwsjq3rl4f6">este link</a>. Los objetivos de este laboratorio son:</p>
<ul>
<li>Entender los componentes basicos de shinydashboard.</li>
<li>Mejorar la interfaz de usuario y organizacion de nuestra aplicacion.</li>
</ul>
<hr />
<p>Primero vamos a segurarnos de que tengamos las librerias que usaremos hoy cargadas, si estas empezando a partir del laboratorio anterior, solo agregaremos el paquete <code>shinydashboard</code> a la lista</p>
<pre class="r"><code># Cargar las librerias
library(shiny)
library(dplyr) # Para manipulacion de datos
library(ggplot2) # Para las figuras
library(shinydashboard) # para crear un dashboard
library(STNet)</code></pre>
<p>Ahora nos aseguramos de que tambien tengamos cargados los datos que usaremos hoy. Asegurate de que hayas cargado previamente el paquete STNet, ya que los datos estan contenidos en esta libreria.</p>
<pre class="r"><code># Cargar los datos del paquete STNet
data(&quot;vac&quot;) # Datos de vacunacion
data(&quot;vigilancia&quot;) # datos de vigilancia
data(&quot;captura&quot;) # Datos de captura</code></pre>
</div>
<div id="definiendo-la-interfaz-ui" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Definiendo la interfaz (ui)</h1>
<p>En nuestro laboratorio pasado desarrollamos una aplicacion que inncluye 3 bases de datos, dos inputs, y 4 figuras. En esta aplicacion no vamos a agregar ninguna base de datos ni figuras, pero vamos a organizar nuestra aplicacion para hacerla mas facil de navegar y presentable.</p>
<div id="encabezado-header" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Encabezado (Header)</h2>
<p>El encabezado contiene el titulo de nuestra aplicacion.<br />
Vamos a crear un nuevo objeto que contenga esta informacion, para esto usamos la funcion <code>dashboardHeader()</code></p>
<pre class="r"><code># Definir Interfaz
# Encabezado -----------
header &lt;- dashboardHeader(title = &#39;Nueva aplicacion&#39;)</code></pre>
</div>
<div id="menu-lateral-sidebar" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Menu lateral (Sidebar)</h2>
<p>El menu lateral nos permite agregar multiples ventanas o tabs para nuestra aplicacion y poder distribuir nuestros material. Para crear el sidebar usamos la funcion <code>dashboardSidebar()</code>. Dentro de esta funcion podemos poner texto que nos ayude a describir nuestra aplicacion.<br />
En esta seccion tambien especificaremos nuestros tabs, para esto usamos la funcion <code>menuItem()</code>, en la que debemos especificar el nombre del tab para mostrar y el identificador que usaremos para la app.</p>
<pre class="r"><code># Sidebar -------------
sidebar &lt;- dashboardSidebar(
  sidebarMenu(
    &#39;Este es un menu para navegar la app&#39;, # Texto que aparecera en nuestra app
    menuItem(&quot;Main&quot;, tabName = &quot;T1&quot;) # Primer tab de nuestra app
    )
  )</code></pre>
<p>En esta aplicacion usaremos el identificador ‘T1’ para nuestro primer tab, y queremos mostrar comom nombre ‘Main’.</p>
</div>
<div id="cuerpo-de-la-aplicacion-body" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Cuerpo de la aplicacion (Body)</h2>
<p>Esta es la parte principal de la app, aqui incluiremos nuestros inputs y outputs</p>
<pre class="r"><code># Body -----------
body &lt;- dashboardBody(
  tabItems(
    # Primer tab
    tabItem(tabName = &#39;T1&#39;,
            fluidRow(column(width = 12, 
                            box(title = &#39;Inputs&#39;, width = 12,
                                selectInput(inputId = &quot;Mun&quot;, label = &quot;Municipios:&quot;, 
                                            choices = unique(vac$NOM_MUN), multiple = T, 
                                            selected = unique(vac$NOM_MUN)),
                                sliderInput(inputId = &#39;year&#39;, label = &#39;Año&#39;, 
                                            min = min(as.numeric(vac$YEAR)), max = max(as.numeric(vac$YEAR)), 
                                            value = range(vac$YEAR))
                                ),
                            box(title = &#39;Vacunacion&#39;, width = 6,
                                plotOutput(&quot;VacMun&quot;), # Figura de serie de tiempo
                                ),
                            box(title = &#39;Vacunacion boxplot&#39;, width = 6,
                                plotOutput(&quot;VacBoxplot&quot;), # Figura de serie de tiempo
                                ),
                            box(title = &#39;Vigilancia&#39;, width = 6,
                                plotOutput(&quot;VigMun&quot;), # Figura de serie de tiempo
                                ),
                            box(title = &#39;Captura&#39;, width = 6,
                                plotOutput(&quot;CapMun&quot;), # Figura de serie de tiempo
                                )
                            )
                     )
            )
    )
)</code></pre>
</div>
<div id="integrar-los-componentes-de-la-interfaz-de-usuario" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Integrar los componentes de la interfaz de usuario</h2>
<p>Finalmente integraremos todos los componentes y guardaremos en el objeto ui:</p>
<pre class="r"><code>ui &lt;- dashboardPage(header = header, sidebar = sidebar, body = body)</code></pre>
</div>
</div>
<div id="servidor" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Servidor</h1>
<p>El resto de nuestra aplicacion se queda igual, ya que solo estamos cambiando la interfaz de usuario.<br />
Vamos a correr la aplicacion para ver nuestro resultado.</p>
<pre class="r"><code># Define server logic required to draw a histogram
server &lt;- function(input, output) {
  x &lt;- reactive({
    p &lt;- vac %&gt;% # base de datos
      filter(NOM_MUN %in% input$Mun,
             between(YEAR, input$year[1], right = input$year[2])) # filtramos los datos
  })
  
  output$VacMun &lt;- renderPlot({
    x() %&gt;% 
      group_by(YEAR) %&gt;% 
      summarise(Vac = sum(VAC_BOV)) %&gt;% 
      ggplot(aes(x = YEAR, y=Vac)) +
      geom_bar(position=&quot;dodge&quot;, stat=&quot;identity&quot;, fill = &quot;deepskyblue4&quot;) +
      labs(x = &quot;Año&quot;, y = &quot;Dosis de vacuna aplicados&quot;,
           title = &quot;Aplicación de vacuna antirrábica&quot;)
  })
  
  output$VacBoxplot &lt;- renderPlot({
    x() %&gt;% 
      group_by(YEAR, NOM_MUN) %&gt;% 
      summarise(Hatos = sum(TOTAL_HATOS, na.rm = T),
                Vacunados = sum(HATOS_VAC, na.rm = T)) %&gt;% 
      mutate(pVac = Vacunados/Hatos) %&gt;% 
      ggplot() +
      geom_boxplot(aes(x = YEAR, y = pVac)) +
      geom_jitter(aes(x = YEAR, y = pVac), width = 0.1)
  })
  
  y &lt;- reactive({
    p &lt;- vigilancia %&gt;% # base de datos
      filter(NOM_MUN %in% input$Mun) %&gt;%
      filter(YEAR %in% c(&quot;2007&quot;, &quot;2008&quot;, &quot;2009&quot;, &quot;2010&quot;, &quot;2011&quot;, &quot;2012&quot;))# filtramos los datos
  })
  
  output$VigMun &lt;- renderPlot({
    y() %&gt;%
      group_by(YEAR, RESULTADO) %&gt;%
      summarise(N = n()) %&gt;%
      ggplot(aes(x = YEAR, y=N, fill=RESULTADO)) +
      geom_bar(position=&quot;dodge&quot;, stat=&quot;identity&quot;)+
      theme(legend.position = &quot;top&quot;) +
      labs(x = &quot;Año&quot;, y = &quot;Muestras enviadas al laboratorio&quot;,
           title = &quot;Vigilancia epidemiológica de rabia paralítica en el suroeste del Estado de México&quot;)
  })
  
  z &lt;- reactive({
    p &lt;- captura %&gt;% # base de datos
      filter(NOM_MUN %in% input$Mun) %&gt;%
      filter(YEAR %in% c(&quot;2007&quot;, &quot;2008&quot;, &quot;2009&quot;, &quot;2010&quot;, &quot;2011&quot;, &quot;2012&quot;))# filtramos los datos
  })
  
  output$CapMun &lt;- renderPlot({
    z() %&gt;%
      group_by(YEAR) %&gt;%
      summarise(N = n()) %&gt;%
      ggplot(aes(x = YEAR, y=N)) +
      geom_bar(position=&quot;dodge&quot;, stat=&quot;identity&quot;, fill = &quot;red4&quot;) +
      labs(x = &quot;Año&quot;, y = &quot;Eventos de captura de murciélago hematófago&quot;,
           title = &quot;Control de población de murciélago hematófago&quot;)
  })
}

# Run the application 
shinyApp(ui = ui, server = server)</code></pre>
</div>
<div id="ejercico" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Ejercico</h1>
<p>Una manera de organizar nuestra aplicacion es dividiendo la informacion en multiples tabs, vamos a crear un tab para cada base de datos y moveremos nuestros inputs al sidebar para poder cambiarlos desde cualquier parte de la applicacion.</p>
<pre class="r"><code># Ejercicio</code></pre>
<p>Ahora intenta crear un nuevo tab para la tercera base de datos</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
